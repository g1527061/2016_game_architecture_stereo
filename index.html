<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Three.js streogram</title>
    <style> body { margin: 0; overflow: hidden;} canvas { width: 100%; height: 100%;}</style>
  </head>
  <body>
    <script src="three.min.js"></script> <!-- Three.js を取得 -->
    <script>
      var scene = new THREE.Scene(); // Three.js シーンオブジェクトの生成
      var width = window.innerWidth;//表示領域の大きさを取得
      var height = window.innerHeight;
      
      var views = [
        {
          left: 0.0,
          eye:[ -0.03, 3, 10],
        },
        {
          left: 0.5,
          eye:[ +0.03, 3, 10],
        },
      ];
      
      var fov = 50;//視野角
      var near = 0.1;// 視錐台の全面までの距離
      var far = 100.0;// 視錐台の後ろまでの距離 
      for(var i in views){
        view = views[i];
        camera = new THREE.PerspectiveCamera( fov, width / height, near, far );
        camera.position.set(view.eye[0], view.eye[1], view.eye[2]);
        camera.lookAt({x:0, y:0, z:0 });
        view.camera = camera;
      }
      
      var renderer = new THREE.WebGLRenderer();// WebGLのレンダラを生成
      renderer.setSize(width, height); // ビューポートの大きさを設定
      renderer.setClearColor( 'cornsilk' );

      document.body.appendChild(renderer.domElement); // レンダラをbodyに紐づけ
  
      var directionalLight = new THREE.DirectionalLight( 0xffffff, 1.0 );// 平行光源を作成（色、強さ）
      directionalLight.position.set( 0.2, 0.7, 0.5 );// 平行光源の向き
      scene.add( directionalLight );// シーンに配置
      
      var geometry = new THREE.CubeGeometry(1, 1, 1); // 四角形の生成
      var material = new THREE.MeshLambertMaterial( { color: 'skyblue' } ) // マテリアルの作成（青）
      var meshes = [];
      var idx = 0;
      for(var x = -1; x <= 1; x++){
        for(var z = 0; z < 3; z++){
          var mesh = new THREE.Mesh(geometry, material); // メッシュとマテリアルからオブジェクトを生成
          mesh.position.x = x * 3;
          mesh.position.z = -z * 3;
          meshes[idx++] = mesh;
          scene.add(mesh); // シーンに配置
        }
      }

      function updateSize() {
        if ( width != window.innerWidth || height != window.innerHeight ) {
          width  = window.innerWidth;
          height = window.innerHeight;
          renderer.setSize ( width, height );
        }
      }
      
      (function update() {
        requestAnimationFrame(update); // ブラウザを更新するためのリクエスト
        updateSize();// 画面サイズの更新
        
        // 少しずつ回転
        for(var i in meshes){
          var mesh = meshes[i];
          mesh.rotation.x += 0.01 * ((i & 3) - 1.0);
          mesh.rotation.y += 0.01 * ((i / 3) - 1.0);
        }
        
        // *** 描画 ***
        
        // 共通の状態の設定
       renderer.setScissorTest( true );// 画面分割の切断処理の有効化

        for(var i in views){
          view = views[i];
          camera = view.camera;
          
          // レンダラのビューポートの設定
          var left   = Math.floor( width  * view.left );
          var w  = Math.floor( width >> 1 );
          var h = Math.floor( height );
          var separation_distance = 0.24*width;
          if(i == 0) separation_distance = -separation_distance;// ０の時は反対方向にずれる

           renderer.setViewport( separation_distance, 0, width, height );// 注視点を各視点の中心に持ってくる
           renderer.setScissor( left, 0, width, height );// 画面の半分だけ更新
           camera.aspect = width / height;
           camera.updateProjectionMatrix();

//          renderer.setClearColor( i == 0 ? 'cornsilk' : 'palegreen' );

          renderer.render( scene, camera ); // 物体を描画
        }
      })();// 定義してそのまま起動
    </script>
  </body>
</html>
